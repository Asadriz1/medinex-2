"use strict";Object.defineProperty(exports, "__esModule", {value: true}); function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }var _chunk2A53XW2Wjs = require('./chunk-2A53XW2W.js');var _chunk2HSCQXHKjs = require('./chunk-2HSCQXHK.js');var _react = require('react'); var _react2 = _interopRequireDefault(_react);var _jssdkcore = require('@privy-io/js-sdk-core');var _viem = require('viem');var _smartwallets = require('@privy-io/js-sdk-core/smart-wallets');var P=o=>_chunk2HSCQXHKjs.d.call(void 0, void 0,[o],function*({chain:t,privyAppId:n,user:a,embeddedWallet:e,smartWalletsConfig:r}){var f,w;if(!(r!=null&&r.enabled)||(e==null?void 0:e.status)!=="connected")return;let i=yield e.getProvider(),l=r==null?void 0:r.configured_networks.find(R=>R.chain_id===`eip155:${t.id}`);if(!l)throw new (0, _jssdkcore.PrivyClientError)({code:"chain_not_supported",error:`The chain ${t.name} (eip155:${t.id}) must be configured in the smart wallet configuration in your dashboard`});let v=(w=(f=_jssdkcore.getUserSmartWallet.call(void 0, a))==null?void 0:f.smart_wallet_type)!=null?w:r.smart_wallet_type,m=_jssdkcore.getJsonRpcEndpointFromChain.call(void 0, t,{rpcUrls:[]},n),p=_viem.createPublicClient.call(void 0, {chain:t,transport:_viem.http.call(void 0, m)}),u=yield _smartwallets.signerToSmartAccountClient.call(void 0, {owner:i,smartWalletType:v,chain:t,publicClient:p,paymasterContext:l.paymaster_context,bundlerUrl:l.bundler_url,paymasterUrl:l.paymaster_url});if(!u)throw new (0, _jssdkcore.PrivyClientError)({code:"smart_wallet_client_error",error:`Failed to create smart wallet client for chain ${t.name} (eip155:${t.id})`});return u});var L=({children:t})=>_react2.default.createElement(J,null,_react2.default.createElement(M,null,_react2.default.createElement(O,null,t))),b=_react.createContext.call(void 0, {config:void 0}),k=()=>{let{config:t}=_react.useContext.call(void 0, b);return{config:t}},E=_react.createContext.call(void 0, {smartWalletClient:void 0}),F=()=>{let{smartWalletClient:t}=_react.useContext.call(void 0, E);return{smartWalletClient:t}},T=_react.createContext.call(void 0, {client:void 0}),j= exports.useSmartWallets =()=>{let{client:t}=_react.useContext.call(void 0, T);return{client:t}},J=({children:t})=>{let[n,a]=_react.useState.call(void 0, void 0),e=_chunk2A53XW2Wjs.x.call(void 0, );return _react.useEffect.call(void 0, ()=>{!n&&e&&(()=>_chunk2HSCQXHKjs.d.call(void 0, void 0,null,function*(){try{if(!e){console.warn("No client found");return}let o=yield e.app.getSmartWalletConfig();a(o)}catch(o){console.warn("Error generating smart wallet config: ",o)}}))()},[e,n]),_react2.default.createElement(b.Provider,{value:{config:n}},t)},M=({children:t})=>{let{config:n}=k(),{client:a,wallet:e,user:r}=_react.useContext.call(void 0, _chunk2HSCQXHKjs.F),[o,i]=_react.useState.call(void 0, );return _react.useEffect.call(void 0, ()=>{(()=>_chunk2HSCQXHKjs.d.call(void 0, void 0,null,function*(){if(!r&&o&&i(void 0),!(n!=null&&n.enabled)||!r||e.status!=="connected"||r&&o&&e.status==="connected")return;let m=a.embeddedWallet.chains.find(u=>n.configured_networks.map(f=>f.chain_id).includes(`eip155:${u.id}`));if(!m)throw new (0, _jssdkcore.PrivyClientError)({error:"Could not find smart wallets chain configurations for any Privy client configured chains. Please configure smart wallets for your chains in the Privy dashboard.",code:"chain_not_supported"});let p=yield P({chain:m,privyAppId:a.app.appId,user:r,embeddedWallet:e,smartWalletsConfig:n});if(!p)throw new (0, _jssdkcore.PrivyClientError)({error:"Could not create smart wallet client",code:"smart_wallet_client_error"});i(p)}))()},[!!(n!=null&&n.enabled),!!a,!!r,e.status]),_react2.default.createElement(E.Provider,{value:{smartWalletClient:o}},t)},O=({children:t})=>{let{client:n,user:a}=_react.useContext.call(void 0, _chunk2HSCQXHKjs.F),{smartWalletClient:e}=F(),{config:r}=k();return _react.useEffect.call(void 0, ()=>{(()=>_chunk2HSCQXHKjs.d.call(void 0, void 0,null,function*(){if(!(!e||!a||_jssdkcore.getUserSmartWallet.call(void 0, a)||!(r!=null&&r.enabled)))try{let{message:i}=yield n.auth.smartWallet.init({address:e.account.address,chainId:`eip155:${e.chain.id}`}),l=yield e.signMessage({message:i});yield n.auth.smartWallet.link(i,l,r.smart_wallet_type)}catch(i){console.error("Error creating smart wallet:",i)}}))()},[!!e,!!a,!!_jssdkcore.getUserSmartWallet.call(void 0, a),r]),_react2.default.createElement(T.Provider,{value:{client:_jssdkcore.getUserSmartWallet.call(void 0, a)?e:void 0}},t)};exports.SmartWalletsProvider = L; exports.useSmartWallets = j;
